<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:sec="http://www.springframework.org/security/facelets/tags">
<ui:composition template="/template/interna.xhtml">
	<ui:define name="titulo">
		<h:graphicImage library="imagens" name="performancelab.png" style="height:40px;"/>
		<h:outputLabel class="label-padrao" value="Controle de Chaves" style="margin-left:250px; font-size:30px; font-family:Ubuntu;"/>
	</ui:define>
	<ui:define name="corpo">
	
	<sec:ifAnyGranted roles="ROLE_CONTROLE_CHAVE_ADM , ROLE_CONTROLE_CHAVE_RECEP , ROLE_CONTROLE_CHAVE_OPER , ROLE_ADM">
	
	<p:growl id="grow" autoUpdate="true" life="4000" showDetail="true" widgetVar="grow" />
<!-- FORM NOVOS //////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	
	<h:form id="novos">
		<p:commandButton class="btnPadrao" value="Nova Requisição" action="#{nceControleChaveBean.novo}"
						update=":cadastro :formTecnico :formEmpresa :formSiteChave :formSite :listaChaves"/>
	</h:form>
<!-- FIM FORM NOVOS////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	

<!-- FORM CADASTRO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	
	<h:form id="cadastro">
		<h:inputHidden id="idControleChave" value="#{nceControleChaveBean.controleChave.id}"/>
		<p:panelGrid style="border-collapse: unset;" class="teste" rendered="#{nceControleChaveBean.formControleChave}">
			<p:row>
				<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="numeroRequisicao" value="Nº Requisição:"/>
				</p:column>
				<p:column style="border-width:0px;">
					<p:inputText class="form-padrao form-mov" style="font-size: 18px; color:red;" id="idAno"
								value="#{nceControleChaveBean.controleChave.idAno}"	size="10" disabled="true"/>
				</p:column>
				
				<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="user" value="Usuário:"/>
				</p:column>
				<p:column style="border-width:0px;">
					<p:inputText class="form-padrao form-mov" style="font-size: 18px; color:red;" id="usuario"
								value="#{nceControleChaveBean.usuario}" disabled="true"/>
				</p:column>
			</p:row>
			
			<p:row>
	            <p:column style="padding: 0px;" colspan="6"></p:column>
	        </p:row>
			
			
			<p:row>
	        	<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="lblSite" value="Sites:"/>
				</p:column>
				
				<sec:ifAnyGranted roles="ROLE_CONTROLE_CHAVE_ADM , ROLE_CONTROLE_CHAVE_OPER , ROLE_ADM">
					<p:column style="border-width:0px;" colspan="2">
						<h:panelGrid columns="1" cellpadding="5">
	    					<p:commandButton class="btnPadrao" style="font-size: 18px;" value="Selecionar Sites"
	    										type="button" onclick="PF('dlgSiteChave').show();"/>
	    				</h:panelGrid>
					</p:column>
				</sec:ifAnyGranted>
	        </p:row>
	        
	       <p:row>
		        <p:column style="border-width:0px;" colspan="3">
						<p:outputLabel id="lblItensSiteChave">
						<p:dataTable value="#{nceControleChaveBean.listaSiteChave}" var="controleSiteChave" scrollable="true" scrollHeight="100"
										emptyMessage="Nenhum site/chave selecionado">
								<p:column headerText="Site" style="font-size: 14px; text-align:center; width:40px;">
						             <h:outputText value="#{controleSiteChave.siteIdCodAtual}" />
						        </p:column>
						        
						        <p:column headerText="Chaves" style="font-size: 14px; text-align:center; width:180px;">
						             <h:outputText value="#{controleSiteChave.listaChaves}" />
						        </p:column>
					    </p:dataTable>
					 </p:outputLabel>
				</p:column>
			</p:row>
			
			<p:row>
	            <p:column style="padding: 0px;" colspan="6"></p:column>
	        </p:row>
			
			 <p:row>
	        	<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="lblTecnico" value="Técnico:"/>
				</p:column>
				<p:column style="border-width:0px;" colspan="1">
					<p:inputMask id="cpf" class="form-padrao form-mov" size="15" value="#{nceControleChaveBean.cpfTecnico}"
									placeholder="Informe um CPF Válido" mask="999.999.999-99" maxlength="11">
						<p:ajax event="blur" listener="#{nceControleChaveBean.tecnicoPorCPF}" update="tecnicoEncontrado"/>
					</p:inputMask>
				</p:column>
				
				<p:column style="border-width:0px;" colspan="2">
					<p:inputText id="tecnicoEncontrado" class="form-padrao form-mov" size="35"
								 value="#{nceControleChaveBean.controleChave.idTecnico.nome}"
								 required="true" requiredMessage="Técnico é obrigatório." disabled="true"/>
				</p:column>
				
				<sec:ifAnyGranted roles="ROLE_CONTROLE_CHAVE_ADM , ROLE_ADM">
					<p:column style="border-width:0px;" colspan="2">
						<h:panelGrid columns="1" cellpadding="5">
	    					<p:commandButton class="btnPadrao" style="font-size: 18px;" value="Novo Técnico"
	    										type="button" onclick="PF('dlgTecnico').show();" />
	    				</h:panelGrid>
					</p:column>
				</sec:ifAnyGranted>
	        </p:row>
	        
			<p:row>
	            <p:column style="padding: 0px;" colspan="6"></p:column>
	        </p:row>
	        
	        <p:row>
				<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="abertura" value="Data Abertura:"/>
				</p:column>
				<p:column style="border-width:0px;">	
	       			<p:calendar id="dataAbertura" value="#{nceControleChaveBean.controleChave.dataAbertura}" pattern="dd-MM-yyyy - HH:mm"
							mask="true" size="14" locale="pt" disabled="true"/>
				</p:column>
				
				<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="crqEmail" value="CRQ:"/>
				</p:column>
				<p:column style="border-width:0px;">			
					<p:inputText id="crq" class="form-padrao form-mov" value="#{nceControleChaveBean.controleChave.crq}"
								placeholder="CRQ ou E-mail" required="true" requiredMessage="CRQ ou E-mail é obrigatório."
								onkeyup="value=value.toUpperCase()"/>
				</p:column>
				
				<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="ativ" value="Atividade:"/>
				</p:column>
				<p:column style="border-width:0px;">			
					<p:inputText id="atividade" class="form-padrao form-mov" value="#{nceControleChaveBean.controleChave.atividade}"
								placeholder="Informar a Atividade" required="true" requiredMessage="Atividade é obrigatória."
								onkeyup="value=value.toUpperCase()"/>
				</p:column>
			</p:row>

	        <p:row>
	            <p:column style="padding: 0px;" colspan="6"></p:column>
	        </p:row>
			
			<p:row>
				<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="observ" value="Observação:"/>
				</p:column>
				<p:column style="border-width:0px;" colspan="3">	
					<p:inputTextarea id="obs" rows="5" cols="60" counter="display" maxlength="1000" counterTemplate="{0} caracteres restantes." 
									value="#{nceControleChaveBean.controleChave.obs}" autoResize="false"
									placeholder="#{nceControleChaveBean.placeHolderObs}"
									required="true" requiredMessage="Obrigatorio preencher o campo observacao"
									onkeyup="value=value.toUpperCase()"/>
		    	</p:column>
		    	<p:column style="border-width:0px;">
		    		<h:outputText id="display"/>
		    	</p:column>
		    </p:row>
		    
		    <p:row>
	            <p:column style="padding: 0px;" colspan="6"></p:column>
	        </p:row>
		    
		    <p:row>
				<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="sts" value="Status:"/>
				</p:column>
				<p:column style="border-width:0px;">
					<p:autoComplete id="status" dropdown="true" forceSelection="true" size="30" scrollHeight="150"
								disabled="#{nceControleChaveBean.campoStatus}" value="#{nceControleChaveBean.nomeStatus}"
								completeMethod="#{nceControleChaveBean.statusRN.listarAtivos}"
								effect="fade" placeholder="Selecionar Status" style="font-size: 10px;"
								required="true" requiredMessage="Selecionar um Status é obrigatório!"
								onkeyup="value=value.toUpperCase()"/>
				</p:column>	
			</p:row>
		    
		    <p:row>
	            <p:column style="padding: 0px;" colspan="6"></p:column>
	        </p:row>
	        
		    <p:row>
				<p:column style="border-width:0px;" colspan="2">	
					<p:commandButton class="btnPadrao" style="font-size: 18px;" action="#{nceControleChaveBean.salvarAtendimento}"
									value="Salvar" update=":cadastro :listaControleChave"/>
				</p:column>
			</p:row>					
		</p:panelGrid>
		
	</h:form>
<!-- FIM FORM CADASTRO////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->
<p:separator />
<!-- FORM FILTROS/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->
<h:form id="filtro">
	<sec:ifAnyGranted roles="ROLE_CONTROLE_CHAVE_ADM , ROLE_CONTROLE_CHAVE_OPER , ROLE_ADM">
		<h:panelGrid columns="6">
					
       		<p:calendar id="dataInicial" value="#{nceControleChaveBean.filtro.dataAbertura}" pattern="dd-MM-yyyy"
						mask="true" size="8" locale="pt" placeholder="Data Inicial"/>

			<p:calendar id="dataFim" value="#{nceControleChaveBean.filtro.dataFechamento}" pattern="dd-MM-yyyy"
					mask="true" size="8" locale="pt" placeholder="Data Final"/>
			
			<p:autoComplete id="buscaIdAno" forceSelection="true" size="15" scrollHeight="250" minQueryLength="3"
							value="#{nceControleChaveBean.filtro.idAno}" completeMethod="#{nceControleChaveBean.controleChaveRN.completeIdAno}"
							effect="fade" placeholder="Buscar por Id/Ano" style="font-size: 10px;"/>
			
			<p:autoComplete id="buscaTecnicoNome" forceSelection="true" size="25" scrollHeight="250" minQueryLength="3"
							value="#{nceControleChaveBean.nomeTecnico}" completeMethod="#{nceControleChaveBean.tecnicoRN.completeTecnico}"
							effect="fade" placeholder="Buscar por Técnico" style="font-size: 10px;"/>
			
			<p:selectOneMenu id="buscaStatusFechamento" value="#{nceControleChaveBean.filtro.statusFechamento}" style="width:185px">
			            <f:selectItem id="statusSubItem" itemLabel="Status Fechamento"/>
			            <f:selectItem itemLabel="Sem Pendências" itemValue="true" />
			            <f:selectItem itemLabel="Com Pendências" itemValue="false" />
	        </p:selectOneMenu>
							
			<p:commandButton class="btnPadrao" value="Consultar" action="#{nceControleChaveBean.consultar}" update=":listaControleChave" />
		</h:panelGrid>
	</sec:ifAnyGranted>
</h:form>
<!-- FORM FILTROS/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->
<p:separator />
<!-- DATATABLE CONTROLECHAVE//////////////////////////////////////////////////////////////////////////////////////////////////////////// -->
<h:form id="listaControleChave">
	<p:poll interval="60" listener="#{nceControleChaveBean.calcTempoAberto}" update=":listaControleChave" stop="#{nceControleChaveBean.stopPoll}"/>
	
		<p:dataTable width="400"  value="#{nceControleChaveBean.lazyControleChave}" lazy="true" widgetVar="tableControleChave"
						var="controleChave" border="1" cellpadding="2" cellspacing="0" rowIndexVar="index"
						paginator="true" paginatorPosition="bottom" rows="10" id="tbl"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						paginatorAlwaysVisible="true"
						currentPageReportTemplate="{totalRecords} Requisições"
						emptyMessage="Nenhum registro encontrado.">
			
			 <f:facet name="header">CONSULTA PADRÃO: NOVAS REQUISIÇÕES</f:facet>
			
			<p:column style="text-align: center;" headerText="Número" width="70" sortBy="#{controleChave.idAno}">
				<h:outputText value="#{controleChave.idAno}"
								style="font-size:14px; color:#{nceControleChaveBean.controlePrazos(controleChave)}"/>
			</p:column>
			
			<p:column style="text-align: center;" width="180" headerText="Abertura" sortBy="#{controleChave.dataAbertura}">
				<h:outputText value="#{controleChave.dataAbertura}"
								style="font-size:14px; color:#{nceControleChaveBean.controlePrazos(controleChave)}">
					<f:convertDateTime pattern="dd/MM/yyyy - H:mm" locale="pt_BR" />
				</h:outputText>
			</p:column>
			
			<p:column style="text-align: center;" width="200" headerText="Operador Abertura">
				<h:outputText value="#{controleChave.usuarioAbertura.nome}"
								style="font-size:14px; color:#{nceControleChaveBean.controlePrazos(controleChave)}"/>
			</p:column>
			
			<p:column style="text-align: center;" width="200" headerText="Técnico">
				<h:outputText value="#{controleChave.idTecnico.nome}" 
								style="font-size:14px; color:#{nceControleChaveBean.controlePrazos(controleChave)}"/>
			</p:column>
			
			<p:column style="text-align: center;" width="200" headerText="Atividade" sortBy="#{controleChave.atividade}">
				<h:outputText value="#{controleChave.atividade}"
							style="font-size:14px; color:#{nceControleChaveBean.controlePrazos(controleChave)}"/>
			</p:column>
			
			<p:column style="text-align: center;" width="100" headerText="Tempo Espera">
				<h:outputText value="#{controleChave.tempoAberto}"
							style="font-size:14px; color:#{nceControleChaveBean.controlePrazos(controleChave)}"/>
			</p:column>
			
			<p:column style="text-align: center;" width="60" headerText="Ações">
			<sec:ifAnyGranted roles="ROLE_CONTROLE_CHAVE_ADM , ROLE_CONTROLE_CHAVE_OPER , ROLE_ADM">
				<p:commandLink action="#{nceControleChaveBean.atenderRequisicao}" update=":cadastro" title="Atender"
								rendered="#{nceControleChaveBean.botaoAtender(controleChave)}">
					<h:graphicImage library="imagens" name="atendimento.png"/>
					<f:setPropertyActionListener value="#{controleChave}" target="#{nceControleChaveBean.controleChave}"/>
				</p:commandLink>
				
				<h:outputText value="  " style="font-size:18px;"/>
				
				<p:commandLink action="#{nceControleChaveBean.carregarListaAnotacao}" update=":anotacao :dlgAnotacao" title="Comentário"
								oncomplete="PF('dlgAnotacao').show();">
					<h:graphicImage library="imagens" name="commentIcon.png"/>
					<f:setPropertyActionListener value="#{controleChave}" target="#{nceControleChaveBean.controleChave}"/>
				</p:commandLink>
				
				<h:outputText value="  " style="font-size:18px;"/>
				
				<p:commandLink action="#{nceControleChaveBean.carregarFechamento}" update=":fechamento :dlgFechamento" title="Fechar"
								oncomplete="PF('dlgFechamento').show();">
					<h:graphicImage library="imagens" name="turnOff.png"/>
					<f:setPropertyActionListener value="#{controleChave}" target="#{nceControleChaveBean.controleChave}"/>
				</p:commandLink>
			</sec:ifAnyGranted>
			</p:column>
		</p:dataTable>
</h:form>
<!-- FIM DATATABLE CONTROLECHAVE/////////////////////////////////////////////////////////////////////////////////////////////////////// -->

<!-- DIALOG FECHAMENTO///////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	

	<p:dialog id="dlgFechamento" rendered="true" position="center" header="Fechamento da Requisição: #{nceControleChaveBean.controleChave.idAno}"
					widgetVar="dlgFechamento" minHeight="40" height="450" width="900px" showEffect="explode" hideEffect="explode" modal="true"
					showCloseIcon="true">
		<h:form id="fechamento">
			<p:panelGrid style="border-collapse: unset;">
				<p:row>
			        <p:column style="border-width:0px;" colspan="3">
							<p:outputLabel id="lblItensSiteChave">
							<p:dataTable value="#{nceControleChaveBean.listaSiteChave}" var="controleSiteChave" scrollable="true" scrollHeight="100"
											emptyMessage="Nenhum site/chave selecionado">
									<p:column headerText="Site" style="font-size: 14px; text-align:center; width:40px;">
							             <h:outputText value="#{controleSiteChave.siteIdCodAtual}" />
							        </p:column>
							        
							        <p:column headerText="Chaves" style="font-size: 14px; text-align:center; width:180px;">
							             <h:outputText value="#{controleSiteChave.listaChaves}" />
							        </p:column>
						    </p:dataTable>
						 </p:outputLabel>
					</p:column>
				</p:row>
				
				<p:row>
	            	<p:column style="padding: 0px;" colspan="6"></p:column>
	        	</p:row>
				
				<p:row>
			        <p:column style="border-width:0px;">
			        	<h:outputLabel class="label-padrao" id="lblStatusFechamento" value="Situação:"/>
			        </p:column>
			        <p:column style="border-width:0px;">
			        	<p:selectBooleanButton id="stsChave" value="#{nceControleChaveBean.controleChave.statusFechamento}"
									onIcon="ui-icon-check" offIcon="ui-icon-closethick" 
									onLabel="Encerrado - OK" offLabel="Encerrado com Pendências"
									disabled="#{nceControleChaveBean.formFechamento}"/>
			        </p:column>
			    </p:row> 
				
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblObsFechamento" value="Comentário:"/>
					</p:column>
					<p:column style="border-width:0px;">
						<p:inputTextarea id="obsFechamento" rows="5" cols="60" counter="displayObsFechamento" maxlength="1000" counterTemplate="{0} caracteres restantes." 
									value="#{nceControleChaveBean.controleChave.obsFechamento}" autoResize="false"
									required="true" requiredMessage="Obrigatorio preencher o campo de observação."
									onkeyup="value=value.toUpperCase()" disabled="#{nceControleChaveBean.formFechamento}"/>
					</p:column>
					
					<p:column style="border-width:0px;">
		    			<h:outputText id="displayObsFechamento"/>
		    		</p:column>
				</p:row>
				
				<p:row>
					<p:column style="border-width:0px;" colspan="2">
						<p:commandButton class="btnPadrao" style="font-size: 18px;" value="Salvar"
										action="#{nceControleChaveBean.fecharRequisicao}"
										onclick="if (!confirm('Confirma o fechamento desta Requisição?')) return false;"
										update=":fechamento :dlgFechamento :listaControleChave"/>
					</p:column>
				</p:row>
				
				<p:row>
	            	<p:column style="padding: 0px;" colspan="6"></p:column>
	        	</p:row>
				
				<p:row>
					<p:column style="border-width:0px;" colspan="2">
			  			<h:outputText class="label-padrao" value="Fechado por: " style="font-size: 14px;"/>
	                   	<h:outputText value="#{nceControleChaveBean.controleChave.usuarioFechamento.nome}" style="font-weight: bold; font-family: Arial;
		                    													color: #343436; font-size: 14px;"/>
		           
			  			<h:outputText class="label-padrao" value="  Data: " style="font-size: 14px;"/>
                    	<h:outputText value="#{nceControleChaveBean.controleChave.dataFechamento}" style="font-weight: bold; font-family: Arial;
                    													color: #343436; font-size: 14px;">
                    	<f:convertDateTime pattern="dd/MM/yyyy - HH:mm" locale="pt_BR" />
                    	</h:outputText>
	                </p:column>
	            </p:row>
	         </p:panelGrid>
		</h:form>
	</p:dialog>
<!-- FIM DIALOG FECHAMENTO///////////////////////////////////////////////////////////////////////////////////////////////////////////// -->

<!-- DIALOG ANOTACAO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	

	<p:dialog id="dlgAnotacao" rendered="true" position="center" header="Comentários da Requisição: #{nceControleChaveBean.controleChave.idAno}"
					widgetVar="dlgAnotacao" minHeight="40" height="400" width="900px" showEffect="explode" hideEffect="explode" modal="true"
					showCloseIcon="true">
		<h:form id="anotacao">
		
			<p:commandButton class="btnPadrao" style="font-size: 18px;" value="Novo Comentário" action="#{nceControleChaveBean.novaAnotacao}"
								update=":anotacao"/>
			<p:separator />
			<p:panelGrid style="border-collapse: unset;" rendered="#{nceControleChaveBean.formAnotacao}">
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblNomeTecnico" value="Comentário:"/>
					</p:column>
					<p:column style="border-width:0px;">
						<p:inputTextarea id="comentario" rows="5" cols="60" counter="displayComentario" maxlength="1000" counterTemplate="{0} caracteres restantes." 
									value="#{nceControleChaveBean.anotacao.obs}" autoResize="false"
									required="true" requiredMessage="Obrigatorio preencher o campo comentário."
									onkeyup="value=value.toUpperCase()"/>
					</p:column>
					
					<p:column style="border-width:0px;">
		    			<h:outputText id="displayComentario"/>
		    		</p:column>
				</p:row>
				
				<p:row>
					<p:column style="border-width:0px;" colspan="2">
						<p:commandButton class="btnPadrao" style="font-size: 18px;" value="Salvar" action="#{nceControleChaveBean.salvarAnotacao}"
								update=":anotacao"/>
					</p:column>
				</p:row>
			</p:panelGrid>
		
		
		<p:outputPanel>
			 <p:dataScroller id="scrollerAnotacoes" value="#{nceControleChaveBean.listaAnotacao}" var="anotacao" chunkSize="10">
			 	<f:facet name="loader">
	            	<p:commandButton type="button" value="Exibir mais" icon="ui-icon-circle-triangle-s"/>
	        	</f:facet>
	        	
	        	<h:panelGrid columns="2" style="width:100%" columnClasses="logo,detail">
	        	
		            <p:graphicImage library="imagens" name="comment.png" /> 
		 
		            <p:outputPanel>
		                <h:panelGrid columns="6" cellpadding="4">
	                	  	 <h:outputText class="label-padrao" value="Data:" style="font-size: 14px;"/>
	                    	<h:outputText value="#{anotacao.dataHoraReg}" style="font-weight: bold; font-family: Arial;
	                    													color: #343436; font-size: 14px;">
	                    	<f:convertDateTime pattern="dd/MM/yyyy - HH:mm" locale="pt_BR" />
	                    	</h:outputText>    
	                	  	
	                	  	<h:outputText class="label-padrao" value="Responsável:" style="font-size: 14px;"/>
	                    	<h:outputText value="#{anotacao.idUsuario.nome}" style="font-weight: bold; font-family: Arial;
		                    													color: #343436; font-size: 14px;"/>
		                </h:panelGrid>
		                
		                <p:separator/>
	              	
		                <p:panelGrid style="border-collapse: unset;">
			                <p:row>
			                	<p:column style="border-width:0px;" colspan="2">
				                	<h:outputText class="label-padrao" value="Comentário:" style="font-size: 14px;"/>
				                </p:column>
				                <p:column style="border-width:0px;" colspan="4">
				                    <p:outputLabel value="#{anotacao.obs}" colspan="2" style="font-weight: bold; font-family: Arial;
				                    													color: #343436; font-size: 14px;"/>
				                </p:column>
				             </p:row>
				        </p:panelGrid>
		            </p:outputPanel>
		            
		        </h:panelGrid>
		        
		        <p:separator style="height:10px;"/>
			 </p:dataScroller>
			</p:outputPanel>
		</h:form>	
					
	</p:dialog>
<!-- FIM DIALOG ANOTACAO/////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	

<!-- DIALOG TECNICO//////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	
	<p:dialog id="dlgTecnico" rendered="true" position="center" header="Cadastro de novo Técnico"
				widgetVar="dlgTecnico" minHeight="40" width="900px" showEffect="explode" hideEffect="explode" modal="true"
				showCloseIcon="true">
				
    	<h:form id="formTecnico">
    		<p:panelGrid style="border-collapse: unset;">
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblNomeTecnico" value="Nome Completo:"/>
					</p:column>
					<p:column style="border-width:0px;" colspan="3">
						<p:autoComplete id="nomeTecnico" dropdown="true" size="50" scrollHeight="150" minQueryLength="3"
								value="#{nceControleChaveBean.tecnico.nome}"
								completeMethod="#{nceControleChaveBean.tecnicoRN.completeTecnico}"
								effect="fade" placeholder="Verifique se este Técnico está cadastrado" style="font-size: 10px;"
								required="true" requiredMessage="Nome do Técnico é obrigatório."
								onkeyup="value=value.toUpperCase()">
							<p:ajax event="blur" listener="#{nceControleChaveBean.tecnicoSelecionado}" update=":formTecnico" />
						</p:autoComplete>
					</p:column>
    			</p:row>
    			
    			<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblfoneFixo1" value="Telefone:"/>
					</p:column>
					<p:column style="border-width:0px;">
						<p:inputMask class="form-padrao form-mov" style="font-size: 18px;" id="foneFixo1"
										value="#{nceControleChaveBean.tecnico.foneFixo1}" mask="(99) 99999999" maxlength="10"/>
					</p:column>
					
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblCelular" value="Celular:"/>
					</p:column>
					<p:column style="border-width:0px;">
						<p:inputMask class="form-padrao form-mov" style="font-size: 18px;" id="celular"
										value="#{nceControleChaveBean.tecnico.celular}" mask="(99) 999999999" maxlength="11"
										required="true" requiredMessage="Celular do Técnico é obrigatório."/>
					</p:column>
    			</p:row>
    			
    			<p:row>
    				<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="lblRg" value="RG:"/>
					</p:column>
					<p:column style="border-width:0px;">			
						<p:inputText id="rg" class="form-padrao form-mov" value="#{nceControleChaveBean.tecnico.rg}"
									placeholder="Informe o RG" required="true" requiredMessage="RG é obrigatório."
									onkeyup="value=value.toUpperCase()"/>
					</p:column>
					
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblCpf" value="CPF:"/>
					</p:column>
					<p:column style="border-width:0px;">			
						<p:inputMask id="cpf" class="form-padrao form-mov" value="#{nceControleChaveBean.tecnico.cpf}"
									placeholder="Informe um CPF Válido" mask="999.999.999-99" maxlength="11"
									required="true" requiredMessage="CPF é obrigatório."
									validator="cpf">
							<p:ajax event="blur" listener="#{nceControleChaveBean.notificacaoCPF}"/>
						</p:inputMask>
					</p:column>
				</p:row>
				
				<p:row>
				<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblRe" value="RE/Funcional:"/>
					</p:column>
					<p:column style="border-width:0px;">			
						<p:inputText id="re" class="form-padrao form-mov" value="#{nceControleChaveBean.tecnico.re}"
									placeholder="Informe o RE ou a Funcional"
									onkeyup="value=value.toUpperCase()"/>
					</p:column>
				</p:row>
				
				 <p:row>
	        	<p:column style="border-width:0px;">
					<h:outputLabel class="label-padrao" id="lblEmpresa" value="Empresa:"/>
				</p:column>
				<p:column style="border-width:0px;" colspan="2">			
					<p:autoComplete id="buscaEmpresa" forceSelection="true" size="40" scrollHeight="250"
								minQueryLength="3" value="#{nceControleChaveBean.nomeEmpresa}"
								completeMethod="#{nceControleChaveBean.empresaRN.completeEmpresa}"
								effect="fade" placeholder="Selecionar Empresa" style="font-size: 10px;"
								required="true" requiredMessage="Empresa é obrigatória."
								onkeyup="value=value.toUpperCase()"/>
				</p:column>
				
				<p:column style="border-width:0px;" colspan="2">
					<h:panelGrid columns="1" cellpadding="5">
    					<p:commandButton class="btnPadrao" style="font-size: 18px;" value="Nova Empresa"
    									type="button" onclick="PF('dlgEmpresa').show();"/>
    				</h:panelGrid>
				</p:column>
	        </p:row>
				
				<p:row>
	            	<p:column style="padding: 0px;" colspan="6"></p:column>
	        	</p:row>
	        	
	        	<p:row>
	        		<p:column style="border-width:0px;" colspan="2">
	        			<p:commandButton class="btnPadrao" style="font-size: 18px;" action="#{nceControleChaveBean.salvarTecnico}"
									value="Salvar" oncomplete="PF('dlgTecnico').hide();"/>
					</p:column>
	        	</p:row>
    		</p:panelGrid>
    	</h:form>
    </p:dialog>
<!-- FIM DIALOG TECNICO///////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->

<!-- DIALOG EMPRESA///////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	
	<p:dialog id="dlgEmpresa" rendered="true" position="center" header="Cadastro de nova Empresa"
				widgetVar="dlgEmpresa" minHeight="40" width="1000px" showEffect="explode" hideEffect="explode" modal="true"
				showCloseIcon="true">
				
    	<h:form id="formEmpresa">
    		<p:panelGrid style="border-collapse: unset;">
    			<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblNomeEmpresa" value="Razão Social:"/>
					</p:column>
					<p:column style="border-width:0px;" colspan="3">
						<p:autoComplete id="nomeEmpresa" size="50" scrollHeight="150" minQueryLength="3"
								value="#{nceControleChaveBean.empresa.razaoSocial}" completeMethod="#{nceControleChaveBean.empresaRN.completeEmpresa}"
								effect="fade" placeholder="Verifique se esta Empresa está cadastrada" style="font-size: 10px;"
								required="true" requiredMessage="Razão Social da Empresa é obrigatória."
								onkeyup="value=value.toUpperCase()">
							<p:ajax event="itemSelect" listener="#{nceControleChaveBean.empresaSelecionada}" update=":formEmpresa" />
						</p:autoComplete>
					</p:column>
    			</p:row>
    			
	    		<p:row>
		           	<p:column style="padding: 0px;" colspan="6"></p:column>
		        </p:row>
    	<!-- WEBSERVICE CORREIOS PARA PEGAR O ENDEREÇO //////////////////////////////////////////////////////////////////////// -->		
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="CEP:" for="cep"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:138px; font-size: 18px;" class="form-padrao form-usuarios" id="cep" 
									label="CEP" value="#{nceControleChaveBean.cep}" maxlength="250"> 
						</h:inputText>
						
					</p:column>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="" for="cep"/>
					</p:column>
					<p:column style="border-width:0px;">
					<h:panelGrid columns="1" cellpadding="5">
						<p:commandButton id="buscaCep" class="btnPadrao" style="font-size: 18px; float:right;" value="Buscar CEP"
										actionListener="#{nceControleChaveBean.buscarEndereco}"	onclick="trocaCursor('wait' , this)"
										oncomplete="trocaCursor('default')" update=":formEmpresa" type="button"/>
					</h:panelGrid>
					</p:column>
				</p:row>
			
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Endereço:" for="endereco"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:338px; font-size: 18px;" class="form-padrao form-usuarios" id="endereco" 
									label="Endereço" value="#{nceControleChaveBean.empresa.endereco}" maxlength="250"
									onkeyup="value=value.toUpperCase()"/> 
					</p:column>
					
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Número:" for="numero"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:80px; font-size: 18px;" class="form-padrao form-usuarios" id="numero" 
									label="Número" value="#{nceControleChaveBean.empresa.numero}" maxlength="10"
									onkeyup="value=value.toUpperCase()"/> 
					</p:column>
					
				</p:row>
			
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Bairro:" for="bairro"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:200px; font-size: 18px;" class="form-padrao form-usuarios" id="bairro" 
									label="Bairro" value="#{nceControleChaveBean.empresa.bairro}" maxlength="150"
									onkeyup="value=value.toUpperCase()"/> 
					</p:column>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Cidade:" for="cidade"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:238px; font-size: 18px;" class="form-padrao form-usuarios" id="cidade" 
									label="Cidade" value="#{nceControleChaveBean.empresa.cidade}" maxlength="150"
									onkeyup="value=value.toUpperCase()"/> 
					</p:column>
					
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="UF:" for="uf"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:50px; font-size: 18px;" class="form-padrao form-usuarios" id="uf" 
									label="UF" value="#{nceControleChaveBean.empresa.uf}" maxlength="2"
									onkeyup="value=value.toUpperCase()"/> 
					</p:column>
				
				</p:row>
		<!-- FIM WEBSERVICE CORREIOS PARA PEGAR O ENDEREÇO //////////////////////////////////////////////////////////////////////// -->	
	    		<p:row>
		            <p:column style="padding: 0px;" colspan="6"></p:column>
		        </p:row>
				
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="observEmpresa" value="Observação:"/>
					</p:column>
					<p:column style="border-width:0px;" colspan="2">	
						<p:inputTextarea id="obsEmpresa" rows="3" cols="40" counter="display" maxlength="255" counterTemplate="{0} caracteres restantes." 
										value="#{nceControleChaveBean.empresa.obs}" autoResize="false" 
										onkeyup="value=value.toUpperCase()"/>
			    	</p:column>
			    	<p:column style="border-width:0px;">
			    		<h:outputText id="display"/>
			    	</p:column>
			    </p:row>
			    
			    <p:row>
		            <p:column style="padding: 0px;" colspan="6"></p:column>
		        </p:row>
	        
    			<p:row>
	        		<p:column style="border-width:0px;" colspan="2">
	        			<p:commandButton id="salvaEmpresa" class="btnPadrao" style="font-size: 18px;" action="#{nceControleChaveBean.salvarEmpresa}"
									value="Salvar" update=":formEmpresa"/>
					</p:column>
	        	</p:row>
    		</p:panelGrid>
    	</h:form>
    </p:dialog>
<!-- FIM DIALOG EMPRESA////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->

<!-- DIALOG SITE E CHAVE///////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	
	<p:dialog id="dlgSiteChave" rendered="true" position="top" header="Cadastro e seleção de novos Sites e Chaves"
				widgetVar="dlgSiteChave" minHeight="40" width="1250px" showEffect="explode" hideEffect="explode" modal="true"
				showCloseIcon="true">
		<p:ajax event="close" listener="#{nceControleChaveBean.fecharDialogSiteChave}"
				update=":cadastro :listaChaves :adicionarChave :formSiteChave"/>
				
    	<h:form id="formSiteChave">
    		<p:panelGrid style="border-collapse: unset;">
    			<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblIdSite" value="Site ID Atual:"/>
					</p:column>
					
					<p:column style="border-width:0px;" colspan="3">
						<p:autoComplete id="siteSelecionado" size="30" scrollHeight="150" minQueryLength="3"
								value="#{nceControleChaveBean.site.idCodAtual}" completeMethod="#{nceControleChaveBean.siteRN.completeSite}"
								effect="fade" placeholder="Selecione o Site requisitado" style="font-size: 10px;"
								required="true" requiredMessage="ID Atual do Site é obrigatório." forceSelection="true"
								onkeyup="value=value.toUpperCase()">
							<p:ajax event="itemSelect" listener="#{nceControleChaveBean.siteRequisitado}" update=":listaChaves"/>
						</p:autoComplete>
					</p:column>
					
					<sec:ifAnyGranted roles="ROLE_CONTROLE_CHAVE_ADM , ROLE_ADM">
						<p:column style="border-width:0px;" colspan="2">
							<h:panelGrid columns="1" cellpadding="5">
		    					<p:commandButton class="btnPadrao" style="font-size: 18px;" value="Cadastrar Novo Site"
		    									type="button" onclick="PF('dlgSite').show();"/>
		    				</h:panelGrid>
						</p:column>
					</sec:ifAnyGranted>
				</p:row>
			</p:panelGrid>
		</h:form>
		
<p:separator/>

<h:form id="listaChaves">
<p:separator/>
<center>
 <p:outputPanel id="itensChave">
	<p:dataTable value="#{nceControleChaveBean.listaChaves}" var="chave" scrollable="true" scrollHeight="160">
		<p:column headerText="Id" style="font-size: 14px; text-align:center; width:10px;">
             <h:outputText value="#{chave.id}" />
        </p:column>
        
        <p:column headerText="Site" style="font-size: 14px; text-align:center; width:20px;">
             <h:outputText value="#{chave.idSite.idCodAtual}" />
        </p:column>
        
        <p:column headerText="Nome Chave" style="font-size: 14px; text-align:center; width:70px;">
             <h:outputText value="#{chave.nome}" />
        </p:column>
        
        <p:column headerText="Tipo" style="font-size: 14px; text-align:center; width:100px;">
             <h:outputText value="#{chave.tipo}" />
        </p:column>
        
        <p:column headerText="Claviculário" style="font-size: 14px; text-align:center; width:70px;">
             <h:outputText value="#{chave.claviculario}" />
        </p:column>
        
        <p:column headerText="Posição" style="font-size: 14px; text-align:center; width:40px;">
             <h:outputText value="#{chave.posicao}" />
        </p:column>
        
       <p:column style="text-align: center;" width="30" headerText="Selecionar">
			<p:commandLink action="#{nceControleChaveBean.selecionarChave}" update=":listaChaves" disabled="#{chave.transito}">
				<h:graphicImage library="imagens" name="hand_#{chave.selecao}.png" style="border:0"/>
				<f:setPropertyActionListener value="#{chave}" target="#{nceControleChaveBean.chave}"/>
			</p:commandLink>	
		</p:column>
		
		 <p:column headerText="Em Trânsito" style="font-size: 14px; text-align:center; width:70px;">
		 	<h:graphicImage library="imagens" name="hand_#{chave.transito}.png" style="border:0"/>
		 	<h:outputText value=" Req: " rendered="#{chave.transito}"/>
            <h:outputText value="#{chave.idControleChave.id}" rendered="#{chave.transito}"/>
        </p:column>
		
		
		<f:facet name="footer">
                <h:outputText value="#{nceControleChaveBean.totalListaChaves}" style="font-size: 18px; text-align:right;"/>
                <h:outputText value=" Chaves" style="font-size: 18px; text-align:right;" />
		</f:facet>
	</p:dataTable>
</p:outputPanel>
<p:separator />
	<p:commandButton class="btnPadrao" value="Salvar" action="#{nceControleChaveBean.atribuirSite}" 
					update=":cadastro :listaChaves :adicionarChave :formSiteChave"
					oncomplete="PF('dlgSiteChave').hide();"/>
</center>
</h:form>

	</p:dialog>
<!-- FIM DIALOG SITE E CHAVE////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	

<!-- DIALOG SITE///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	
	<p:dialog id="dlgSite" rendered="true" position="center" header="Cadastro de novos Sites"
				widgetVar="dlgSite" minHeight="40" width="1000px" showEffect="explode" hideEffect="explode" modal="true"
				showCloseIcon="true">
				
    	<h:form id="formSite">
    		<p:panelGrid style="border-collapse: unset;">
    			<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="lblIdSiteAtual" value="Site ID Atual:"/>
					</p:column>
					
					<p:column style="border-width:0px;" colspan="3">
						<p:autoComplete id="siteIdCodAtual" size="30" scrollHeight="150" minQueryLength="3"
								value="#{nceControleChaveBean.site.idCodAtual}" completeMethod="#{nceControleChaveBean.siteRN.completeSite}"
								effect="fade" placeholder="Verifique se este Site está cadastrado" style="font-size: 10px;"
								required="true" requiredMessage="Código do Site é obrigatório."
								onkeyup="value=value.toUpperCase().trim()"
								validatorMessage="O Site deve conter entre 5 a 15 caracteres maiúsculos sem espaços.">
							<f:validateRegex pattern="([A-Z]|[0-9]){5,15}"/>
							<p:ajax event="blur" listener="#{nceControleChaveBean.siteSelecionado}" update=":formSite" />
						</p:autoComplete>
					</p:column>
				</p:row>
				
				<p:row>
		           	<p:column style="padding: 0px;" colspan="6"></p:column>
		        </p:row>
    	<!-- WEBSERVICE CORREIOS PARA PEGAR O ENDEREÇO //////////////////////////////////////////////////////////////////////// -->		
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="CEP:" for="cepSite"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:138px; font-size: 18px;" class="form-padrao form-usuarios" id="cepSite" 
									label="CEP" value="#{nceControleChaveBean.cep}" maxlength="250"> 
						</h:inputText>
						
					</p:column>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="" for="cep"/>
					</p:column>
					<p:column style="border-width:0px;">
					<h:panelGrid columns="1" cellpadding="5">
						<p:commandButton id="buscaCepSite" class="btnPadrao" style="font-size: 18px; float:right;" value="Buscar CEP"
										actionListener="#{nceControleChaveBean.buscarEnderecoSite}"	onclick="trocaCursor('wait' , this)"
										oncomplete="trocaCursor('default')" update=":formSite" type="button"/>
					</h:panelGrid>
					</p:column>
				</p:row>
			
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Endereço:" for="enderecoSite"/>
					</p:column>
					<p:column style="border-width:0px;" colspan="2">
						<h:inputText style="width:338px; font-size: 18px;" class="form-padrao form-usuarios" id="enderecoSite" 
									label="Endereço" value="#{nceControleChaveBean.site.endereco}" maxlength="250"
									onkeyup="value=value.toUpperCase()"> 
						</h:inputText>
					</p:column>
				</p:row>
			
				<p:row>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Bairro:" for="bairroSite"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:200px; font-size: 18px;" class="form-padrao form-usuarios" id="bairroSite" 
									label="Bairro" value="#{nceControleChaveBean.site.bairro}" maxlength="150"
									onkeyup="value=value.toUpperCase()"> 
						</h:inputText>
					</p:column>
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Cidade:" for="cidadeSite"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:238px; font-size: 18px;" class="form-padrao form-usuarios" id="cidadeSite" 
									label="Cidade" value="#{nceControleChaveBean.site.cidade}" maxlength="150"
									onkeyup="value=value.toUpperCase()"> 
						</h:inputText>
					</p:column>
					
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="UF:" for="ufSite"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:50px; font-size: 18px;" class="form-padrao form-usuarios" id="ufSite" 
									label="UF" value="#{nceControleChaveBean.site.uf}" maxlength="2"
									onkeyup="value=value.toUpperCase()"> 
						</h:inputText>
					</p:column>
				
				</p:row>
		<!-- FIM WEBSERVICE CORREIOS PARA PEGAR O ENDEREÇO //////////////////////////////////////////////////////////////////////// -->	
	    		<p:row>
		            <p:column style="padding: 0px;" colspan="6"></p:column>
		        </p:row>
		        
		        <p:row>
		        	<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Latitude:" for="lat"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:180px; font-size: 18px;" class="form-padrao form-usuarios" id="lat" 
									label="LAT" value="#{nceControleChaveBean.site.lat}" maxlength="12">
							<f:convertNumber minFractionDigits="6" locale="pt_BR"/> 
						</h:inputText>
					</p:column>
					
					<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" value="Longitude:" for="lng"/>
					</p:column>
					<p:column style="border-width:0px;">
						<h:inputText style="width:180px; font-size: 18px;" class="form-padrao form-usuarios" id="lng" 
									label="LNG" value="#{nceControleChaveBean.site.lng}" maxlength="12">
							<f:convertNumber minFractionDigits="6" pattern="##,######" locale="pt_BR"/>
						</h:inputText>
					</p:column>
		        </p:row>
		        
		        <p:row>
		        	<p:column style="border-width:0px;">
						<h:outputLabel class="label-padrao" id="observSite" value="Observação:"/>
					</p:column>
					<p:column style="border-width:0px;" colspan="2">	
						<p:inputTextarea id="obsSite" rows="3" cols="40" counter="displaySite" maxlength="255"
										counterTemplate="{0} caracteres restantes."	value="#{nceControleChaveBean.site.obs}"
										autoResize="false" onkeyup="value=value.toUpperCase()"/>
			    	</p:column>
			    	<p:column style="border-width:0px;">
			    		<h:outputText id="displaySite"/>
			    	</p:column>
		        </p:row>
		         <p:row>
		            <p:column style="padding: 0px;" colspan="6"></p:column>
		        </p:row>
	        
    			<p:row>
	        		<p:column style="border-width:0px;" colspan="2">
	        			<p:commandButton id="salvarSite" class="btnPadrao" style="font-size: 18px;"
	        							action="#{nceControleChaveBean.salvarSite}" value="Salvar" update=":formSite"/>
					</p:column>
	        	</p:row>
			</p:panelGrid>
		</h:form>
	</p:dialog>
<!-- FIM DIALOG SITE/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->	

	</sec:ifAnyGranted>
	</ui:define>
</ui:composition>
</html>